name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test-security:
    name: Security Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - name: Install dependencies
        run: |
          pip install -r requirements-test.txt
          pip install -e .
      - name: Run security tests
        run: pytest tests/test_security_*.py -v --tb=short

  test-memory:
    name: Memory Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - name: Install dependencies
        run: |
          pip install -r requirements-test.txt
          pip install -e .
      - name: Run memory tests
        run: pytest tests/test_memory_*.py -v --tb=short

  test-config:
    name: Config Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - name: Install dependencies
        run: |
          pip install -r requirements-test.txt
          pip install -e .
      - name: Run config tests
        run: pytest tests/test_config_*.py -v --tb=short

  test-engine:
    name: Engine & BDI Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - name: Install dependencies
        run: |
          pip install -r requirements-test.txt
          pip install -e .
      - name: Run engine and BDI tests
        run: |
          pytest tests/test_shadow_fork.py tests/test_verifier.py tests/test_promoter.py \
                 tests/test_evolution.py tests/test_calibration.py tests/test_bloom_adapter.py \
                 tests/test_drift_detector.py tests/test_bdi_*.py -v --tb=short

  test-adapters:
    name: Adapter Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - name: Install dependencies
        run: |
          pip install -r requirements-test.txt
          pip install -e .
      - name: Run adapter tests
        run: pytest tests/test_adapters_*.py -v --tb=short

  test-skills:
    name: Skills Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - name: Install dependencies
        run: |
          pip install -r requirements-test.txt
          pip install -e .
      - name: Run skills tests
        run: pytest tests/test_skills_*.py -v --tb=short

  test-core:
    name: Core & Integration Tests
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"
      - name: Install dependencies
        run: |
          pip install -r requirements-test.txt
          pip install -e .
      - name: Run core tests
        run: |
          pytest tests/test_cognition_*.py tests/test_governance_*.py \
                 tests/test_integrations_*.py tests/test_api_extensions.py \
                 tests/test_cli.py tests/test_multitenancy.py tests/test_plugins.py \
                 tests/test_tuning.py tests/test_phase1_integration.py -v --tb=short
